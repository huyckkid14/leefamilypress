name: Replace All Headers

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  replace-header:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Replace headers from header.html
        shell: bash
        run: |
          set -e

          # Read the full header (including <style>) from external file
          new_header=$(cat header.html)

          echo "ðŸ”§ Starting header replacement..."

          # Find and replace headers in all HTML files except .git directory
          find . -type f -name "*.html" -not -path "./.git/*" | while read -r file; do
            echo "â†’ Processing $file"

            # Only replace if file contains a <header> tag
            if grep -q "<header" "$file"; then
              cp "$file" "$file.bak"
              perl -0777 -i -pe "s|<header>.*?</header>|$new_header|gs" "$file"
            fi
          done

          echo "âœ… Header replacement complete."

      - name: Commit and push if changes
        shell: bash
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add .
          if git diff --cached --quiet; then
            echo "âœ… No changes to commit."
          else
            git commit -m "Automated header update via header.html"
            git push
            echo "ðŸš€ Header changes pushed successfully!"
          fi
